generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SubscriptionTier {
  FREE
  PREMIUM
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  passwordHash  String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  watchlist     Watchlist[]
  reports       SavedReport[]
  usageLogs     UsageLog[]
  subscription  Subscription?
}

model SavedReport {
  id          String   @id @default(cuid())
  userId      String
  symbol      String
  reportJson  Json
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, symbol, expiresAt])
}

model Watchlist {
  id          String   @id @default(cuid())
  userId      String
  symbol      String
  assetClass  String
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Subscription {
  id          String           @id @default(cuid())
  userId      String           @unique
  tier        SubscriptionTier @default(FREE)
  status      String           @default("active")
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UsageLog {
  id          String   @id @default(cuid())
  userId      String
  endpoint    String
  metadata    Json?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, endpoint])
}
